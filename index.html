<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ê³„ ê²½ì œ í†µê³„ ëŒ€ì‹œë³´ë“œ - World Bank API</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 5px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group.button-group {
            flex: 0 0 auto;
            display: flex;
            align-items: flex-end;
            justify-content: flex-end;
            min-width: auto;
            padding-left: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }

        select, input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .charts-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        @media (max-width: 1024px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        .chart-wrapper {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 450px;
            display: flex;
            flex-direction: column;
        }

        .chart-wrapper canvas {
            flex: 1;
            min-height: 400px;
        }

        #dataTable {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
        }

        table th,
        table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        table th:first-child,
        table td:first-child {
            text-align: left;
            font-weight: 600;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        table tr:last-child td {
            border-bottom: none;
        }

        table td {
            color: #555;
        }

        .chart-title {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #c33;
        }

        .info-box {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #2196F3;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
                justify-content: flex-start;
                align-items: stretch;
            }

            .container {
                padding: 15px;
                margin: 0;
                border-radius: 10px;
            }

            h1 {
                font-size: 1.5em;
                margin-bottom: 5px;
            }

            .subtitle {
                font-size: 0.85em;
                margin-bottom: 10px;
            }

            .info-box {
                padding: 8px;
                font-size: 0.85em;
                margin-bottom: 10px;
            }

            .controls {
                padding: 10px;
                gap: 10px;
                margin-bottom: 10px;
            }

            .control-group {
                min-width: 100%;
            }

            .control-group.button-group {
                padding-left: 0;
                justify-content: stretch;
            }

            button {
                width: 100%;
                padding: 10px 20px;
                font-size: 14px;
            }

            .charts-container {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-top: 10px;
            }

            .chart-wrapper {
                padding: 12px;
                height: 280px;
                max-height: 280px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }

            .chart-wrapper canvas {
                max-width: 100%;
                width: 100% !important;
                max-height: 240px;
            }

            .chart-title {
                font-size: 0.95em;
                margin-bottom: 6px;
            }

            #dataTable {
                max-height: 280px;
                min-height: 280px;
            }

            table {
                font-size: 12px;
            }

            table th,
            table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ ì„¸ê³„ ê²½ì œ í†µê³„ ëŒ€ì‹œë³´ë“œ</h1>
        <p class="subtitle">World Bank APIë¥¼ í™œìš©í•œ ê°êµ­ì˜ ì£¼ìš” ê²½ì œ ì§€í‘œ ë¹„êµ ë° ì‹œê°í™”</p>

        <div class="info-box">
            <strong>ì‚¬ìš© ë°©ë²•:</strong> êµ­ê°€ì™€ ì§€í‘œë¥¼ ì„ íƒí•œ í›„ "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”. 
            World Bank APIë¥¼ í†µí•´ ìµœì‹  ê²½ì œ í†µê³„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. (ë¬´ë£Œ ê³µê°œ API)
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="country">êµ­ê°€ ì„ íƒ:</label>
                <select id="country">
                    <option value="KR">í•œêµ­ (Korea)</option>
                    <option value="US">ë¯¸êµ­ (United States)</option>
                    <option value="CN">ì¤‘êµ­ (China)</option>
                    <option value="JP">ì¼ë³¸ (Japan)</option>
                    <option value="DE">ë…ì¼ (Germany)</option>
                    <option value="GB">ì˜êµ­ (United Kingdom)</option>
                    <option value="FR">í”„ë‘ìŠ¤ (France)</option>
                    <option value="IN">ì¸ë„ (India)</option>
                    <option value="BR">ë¸Œë¼ì§ˆ (Brazil)</option>
                    <option value="RU">ëŸ¬ì‹œì•„ (Russia)</option>
                    <option value="CZ">ì²´ì½” (Czech Republic)</option>
                    <option value="SK">ìŠ¬ë¡œë°”í‚¤ì•„ (Slovakia)</option>
                </select>
            </div>
            <div class="control-group">
                <label for="indicator">ê²½ì œ ì§€í‘œ ì„ íƒ:</label>
                <select id="indicator">
                    <option value="NGDP_RPCH">GDP ì„±ì¥ë¥  (ì—°ê°„ %)</option>
                    <option value="PCPIPCH">ì¸í”Œë ˆì´ì…˜ìœ¨ (ì—°ê°„ %)</option>
                    <option value="LUR">ì‹¤ì—…ë¥  (%)</option>
                    <option value="NGDPD">GDP (í˜„ì¬ ê°€ê²©, USD)</option>
                    <option value="GDP_PCAP">1ì¸ë‹¹ GDP (USD)</option>
                    <option value="BCA">ê²½ìƒìˆ˜ì§€ (GDP ëŒ€ë¹„ %)</option>
                </select>
            </div>
            <div class="control-group">
                <label for="startYear">ì‹œì‘ ì—°ë„:</label>
                <input type="number" id="startYear" value="2015" min="1980" max="2024">
            </div>
            <div class="control-group">
                <label for="endYear">ì¢…ë£Œ ì—°ë„:</label>
                <input type="number" id="endYear" value="2024" min="1980" max="2024">
            </div>
            <div class="control-group button-group">
                <button id="loadData" onclick="loadIMFData()">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>

        <div id="errorMessage"></div>
        <div id="loadingMessage" class="loading" style="display: none;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        
        <div class="charts-container" id="chartsContainer">
            <div class="chart-wrapper">
                <div class="chart-title">ì„  ê·¸ë˜í”„</div>
                <canvas id="lineChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <div class="chart-title">ì—°ë„ë³„ ë°ì´í„°</div>
                <div id="dataTable"></div>
            </div>
        </div>
    </div>

    <script>
        let lineChartInstance = null;

        // IMF Data Portal APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function loadIMFData() {
            const country = document.getElementById('country').value;
            const indicator = document.getElementById('indicator').value;
            const startYear = document.getElementById('startYear').value;
            const endYear = document.getElementById('endYear').value;

            // ì…ë ¥ ê²€ì¦
            if (parseInt(startYear) > parseInt(endYear)) {
                showError('ì‹œì‘ ì—°ë„ëŠ” ì¢…ë£Œ ì—°ë„ë³´ë‹¤ ì‘ì•„ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('errorMessage').innerHTML = '';
            document.getElementById('loadData').disabled = true;

            try {
                // Render ì„œë²„ë¥¼ í†µí•´ World Bank API í˜¸ì¶œ (ë¬´ë£Œ ê³µê°œ API)
                const functionUrl = `/api/worldbank-api?indicator=${encodeURIComponent(indicator)}&country=${encodeURIComponent(country)}&startYear=${encodeURIComponent(startYear)}&endYear=${encodeURIComponent(endYear)}`;
                
                console.log('API URL:', functionUrl);
                
                // íƒ€ì„ì•„ì›ƒ ì„¤ì • (35ì´ˆ - ì„œë²„ íƒ€ì„ì•„ì›ƒ 30ì´ˆë³´ë‹¤ ì•½ê°„ ê¸¸ê²Œ)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 35000);
                
                let response;
                try {
                    response = await fetch(functionUrl, {
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                } catch (fetchError) {
                    clearTimeout(timeoutId);
                    if (fetchError.name === 'AbortError') {
                        throw new Error('ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤ (35ì´ˆ). World Bank APIê°€ ëŠë¦¬ê²Œ ì‘ë‹µí•˜ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    }
                    throw new Error(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${fetchError.message}. ì„œë²„ê°€ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.`);
                }
                
                console.log('ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                
                if (!response.ok) {
                    let errorData = {};
                    try {
                        const text = await response.text();
                        errorData = text ? JSON.parse(text) : {};
                    } catch (e) {
                        console.error('ì—ëŸ¬ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨:', e);
                    }
                    
                    const errorMessage = errorData.error || errorData.message || `HTTP ì˜¤ë¥˜: ${response.status} ${response.statusText}`;
                    const errorDetails = errorData.details || errorData.name || '';
                    console.error('API ì˜¤ë¥˜:', errorMessage, errorData);
                    console.error('ì—ëŸ¬ ìƒì„¸:', errorDetails);
                    
                    if (response.status === 404) {
                        throw new Error('API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
                    }
                    
                    // 500 ì˜¤ë¥˜ì¸ ê²½ìš° ë” ìì„¸í•œ ì •ë³´ ì œê³µ
                    if (response.status === 500) {
                        const detailedError = `${errorMessage}${errorDetails ? '\nìƒì„¸: ' + errorDetails.substring(0, 200) : ''}`;
                        throw new Error(detailedError);
                    }
                    
                    throw new Error(errorMessage);
                }
                
                let imfData;
                try {
                    imfData = await response.json();
                    console.log('ë°›ì€ ë°ì´í„°:', imfData);
                } catch (parseError) {
                    console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', parseError);
                    throw new Error(`ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${parseError.message}`);
                }

                // ë°ì´í„° ì²˜ë¦¬ (ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ finally ì‹¤í–‰ë˜ë„ë¡ try-catch)
                try {
                    processData(imfData, country, indicator);
                } catch (processError) {
                    console.error('ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜:', processError);
                    throw processError; // ìƒìœ„ catchë¡œ ì „ë‹¬
                }
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                
                // 502 Bad GatewayëŠ” API ì ‘ê·¼ ë¶ˆê°€ë¥¼ ì˜ë¯¸
                if (error.message.includes('502') || error.message.includes('Bad Gateway')) {
                    console.warn('IMF API ì ‘ê·¼ ë¶ˆê°€ - ìƒ˜í”Œ ë°ì´í„°ë¡œ ì „í™˜');
                    showSampleData(country, indicator, startYear, endYear);
                } else {
                    const errorMsg = `ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`;
                    showError(errorMsg + '<br><small>ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</small>');
                    
                    // ìƒ˜í”Œ ë°ì´í„°ë¡œ ë°ëª¨ í‘œì‹œ
                    try {
                        showSampleData(country, indicator, startYear, endYear);
                    } catch (sampleError) {
                        console.error('ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ ì˜¤ë¥˜:', sampleError);
                    }
                }
            } finally {
                // í•­ìƒ ë¡œë”© ìƒíƒœ í•´ì œ
                console.log('ë¡œë”© ì™„ë£Œ - ìƒíƒœ í•´ì œ');
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('loadData').disabled = false;
            }
        }

        function processData(data, country, indicator) {
            try {
                console.log('ë°ì´í„° íŒŒì‹± ì‹œì‘:', data);
                
                // World Bank API ì‘ë‹µ êµ¬ì¡° íŒŒì‹±
                // World Bank APIëŠ” {values: {year: value}} í˜•íƒœë¡œ ë³€í™˜ë˜ì–´ ë°˜í™˜ë¨
                let values = {};
                
                // World Bank API ì‘ë‹µ êµ¬ì¡° ì²˜ë¦¬
                if (data.values) {
                    // {values: {2020: 2.3, 2021: 5.7}}
                    values = data.values;
                } else if (data[country]) {
                    // ì§ì ‘ êµ­ê°€ ì½”ë“œë¡œ ì ‘ê·¼
                    values = data[country];
                } else if (data[indicator] && data[indicator][country]) {
                    // {indicator: {country: {year: value}}}
                    values = data[indicator][country];
                } else if (Array.isArray(data)) {
                    // ë°°ì—´ í˜•íƒœì¸ ê²½ìš° (World Bank ì›ë³¸ í˜•ì‹ì¼ ìˆ˜ ìˆìŒ)
                    const dataObj = {};
                    data.forEach(item => {
                        if (item.date && item.value !== undefined && item.value !== null) {
                            const year = parseInt(item.date);
                            if (year) dataObj[year] = item.value;
                        }
                    });
                    values = dataObj;
                } else {
                    // ì „ì²´ ë°ì´í„° êµ¬ì¡° ì¶œë ¥í•˜ì—¬ ë””ë²„ê¹…
                    console.warn('ì•Œ ìˆ˜ ì—†ëŠ” ë°ì´í„° êµ¬ì¡°:', data);
                    // ë§ˆì§€ë§‰ ì‹œë„: ì „ì²´ ê°ì²´ì—ì„œ ì—°ë„ í‚¤ ì°¾ê¸°
                    for (const key in data) {
                        if (!isNaN(key) && key.length === 4) {
                            values[key] = data[key];
                        }
                    }
                }
                
                console.log('ì¶”ì¶œëœ ê°’ë“¤:', values);
                
                const labels = [];
                const chartData = [];
                const startYear = parseInt(document.getElementById('startYear').value);
                const endYear = parseInt(document.getElementById('endYear').value);

                // ì—°ë„ë³„ ë°ì´í„° ì¶”ì¶œ
                for (let year = startYear; year <= endYear; year++) {
                    labels.push(year.toString());
                    
                    // ë‹¤ì–‘í•œ í˜•ì‹ì˜ í‚¤ ì‹œë„
                    let value = null;
                    if (values[year] !== undefined && values[year] !== null) {
                        value = values[year];
                    } else if (values[year.toString()] !== undefined && values[year.toString()] !== null) {
                        value = values[year.toString()];
                    } else if (values[`${year}-01-01`] !== undefined) {
                        value = values[`${year}-01-01`];
                    }
                    
                    // ìˆ«ìë¡œ ë³€í™˜ (ë¬¸ìì—´ì¸ ê²½ìš°)
                    if (value !== null && value !== undefined) {
                        const numValue = parseFloat(value);
                        chartData.push(isNaN(numValue) ? null : numValue);
                    } else {
                        chartData.push(null);
                    }
                }

                // ë°ì´í„°ê°€ ëª¨ë‘ nullì¸ì§€ í™•ì¸
                const hasData = chartData.some(v => v !== null);
                if (!hasData) {
                    throw new Error('í•´ë‹¹ ê¸°ê°„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì—°ë„ ë²”ìœ„ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”.');
                }

                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                updateCharts(labels, chartData, getIndicatorName(indicator), country);
                
            } catch (error) {
                console.error('ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                console.error('ë°›ì€ ë°ì´í„°:', JSON.stringify(data, null, 2));
                showError(`ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}<br><small>ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</small>`);
                showSampleData(country, indicator, 
                    document.getElementById('startYear').value, 
                    document.getElementById('endYear').value);
            }
        }

        function showSampleData(country, indicator, startYear, endYear) {
            // í˜„ì‹¤ì ì¸ ìƒ˜í”Œ ë°ì´í„° ìƒì„± (API ì ‘ê·¼ ì‹¤íŒ¨ ì‹œ ë°ëª¨ìš©)
            const labels = [];
            const chartData = [];
            
            // ì§€í‘œë³„ í˜„ì‹¤ì ì¸ ë°ì´í„° ë²”ìœ„ ì„¤ì •
            const sampleRanges = {
                'NGDP_RPCH': { min: -2, max: 8 },      // GDP ì„±ì¥ë¥ : -2% ~ 8%
                'PCPIPCH': { min: 0, max: 5 },         // ì¸í”Œë ˆì´ì…˜ìœ¨: 0% ~ 5%
                'LUR': { min: 2, max: 12 },            // ì‹¤ì—…ë¥ : 2% ~ 12%
                'NGDPD': { min: 1000000, max: 50000000 }, // GDP: 1ì¡° ~ 50ì¡°
                'GDP_PCAP': { min: 1000, max: 80000 }, // 1ì¸ë‹¹ GDP: 1,000 ~ 80,000 USD
                'BCA': { min: -5, max: 5 }             // ê²½ìƒìˆ˜ì§€: -5% ~ 5%
            };
            
            const range = sampleRanges[indicator] || { min: -2, max: 10 };
            
            // ì—°ë„ë³„ë¡œ ì•½ê°„ì˜ ì¶”ì„¸ë¥¼ ê°€ì§„ ë°ì´í„° ìƒì„±
            let baseValue = (range.min + range.max) / 2;
            const trend = (Math.random() - 0.5) * 0.5; // ì•½ê°„ì˜ ìƒìŠ¹/í•˜ë½ ì¶”ì„¸
            
            for (let year = parseInt(startYear); year <= parseInt(endYear); year++) {
                labels.push(year.toString());
                // ì¶”ì„¸ë¥¼ ë°˜ì˜í•œ í˜„ì‹¤ì ì¸ ë°ì´í„° ìƒì„±
                baseValue += trend + (Math.random() - 0.5) * (range.max - range.min) * 0.2;
                baseValue = Math.max(range.min, Math.min(range.max, baseValue));
                chartData.push(parseFloat(baseValue.toFixed(2)));
            }

            updateCharts(labels, chartData, getIndicatorName(indicator), country);
            
            const countryName = document.getElementById('country').selectedOptions[0].text;
            showError(`âš ï¸ World Bank APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì–´ <strong>ìƒ˜í”Œ ë°ì´í„°</strong>ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.<br>
                      <small>World Bank APIê°€ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš© ë¶ˆê°€ëŠ¥í•˜ê±°ë‚˜, ë„¤íŠ¸ì›Œí¬ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                      ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</small>`);
        }

        function updateCharts(labels, data, indicatorName, country) {
            const countryName = document.getElementById('country').selectedOptions[0].text;
            
            // ì„  ê·¸ë˜í”„
            const lineCtx = document.getElementById('lineChart').getContext('2d');
            if (lineChartInstance) {
                lineChartInstance.destroy();
            }
            lineChartInstance = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${countryName} - ${indicatorName}`,
                        data: data,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: window.innerWidth <= 768 ? 1.2 : 2,
                    layout: {
                        padding: window.innerWidth <= 768 ? { bottom: 5, top: 5 } : {}
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: indicatorName
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'ì—°ë„'
                            }
                        }
                    }
                }
            });

            // ë°ì´í„° í‘œ ìƒì„±
            const tableContainer = document.getElementById('dataTable');
            let tableHTML = '<table><thead><tr><th>ì—°ë„</th><th>' + indicatorName + '</th></tr></thead><tbody>';
            
            for (let i = 0; i < labels.length; i++) {
                const value = data[i];
                const formattedValue = value !== null && value !== undefined 
                    ? (typeof value === 'number' ? value.toLocaleString('ko-KR', { 
                        minimumFractionDigits: 2, 
                        maximumFractionDigits: 2 
                    }) : value)
                    : 'N/A';
                tableHTML += `<tr><td>${labels[i]}</td><td>${formattedValue}</td></tr>`;
            }
            
            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
        }

        function getIndicatorName(code) {
            const names = {
                'NGDP_RPCH': 'GDP ì„±ì¥ë¥  (%)',
                'PCPIPCH': 'ì¸í”Œë ˆì´ì…˜ìœ¨ (%)',
                'LUR': 'ì‹¤ì—…ë¥  (%)',
                'NGDPD': 'GDP (USD)',
                'GDP_PCAP': '1ì¸ë‹¹ GDP (USD)',
                'BCA': 'ê²½ìƒìˆ˜ì§€ (GDP ëŒ€ë¹„ %)'
            };
            return names[code] || code;
        }

        function showError(message) {
            document.getElementById('errorMessage').innerHTML = `<div class="error">${message}</div>`;
        }

        // í™”ë©´ íšŒì „ ë° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                if (lineChartInstance) {
                    lineChartInstance.resize();
                }
            }, 250);
        });

        // í™”ë©´ íšŒì „ ê°ì§€ ë° ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (lineChartInstance) {
                    lineChartInstance.resize();
                }
            }, 100);
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        window.addEventListener('load', () => {
            // ì´ˆê¸° ë¡œë“œëŠ” í•˜ì§€ ì•Šê³  ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ë„ë¡ í•¨
        });
    </script>
</body>
</html>

